# Direct Enpack - прямоугольный раскрой

Это CPG-аддон к CorelDraw для компоновки прямоугольных объектов на лист - аналог [функции "прямоугольный раскрой" из пакета ECut](http://www.e-cut.ru/index.php?view=function&functionid=10).

## Системные требования

- **Операционная система:** Windows XP или выше
- **Программное обеспечение:** Corel Draw версии 13 или выше
- **Процессор:** с поддержкой SSE4.1. Алгоритм многопоточный - большое количество ядер приветствуется.

## Установка

Скопировать файл [DirectEnpackx64.cpg](https://github.com/fersatgit/DirectEnpack/releases/download/1.0/DirectEnpackx64.cpg) в каталог `путь_к_CorelDraw\Programs64\Addons`.

## Работа с аддоном

1.  Выделить объекты для компоновки.
2.  Запустить аддон при помощи иконки ![icon](icon.ico) на панели "Стандарт".
3.  В появившемся диалоговом окне настроить параметры компоновки:

    ![Настройки](1.png)

    - В полях **ширина** и **высота** задаётся размер листа в миллиметрах.
    - **Отступ** - это минимальное расстояние между объектами в миллиметрах.
    - Галочка **"Перемешать"** рандомизирует порядок объектов перед компоновкой. Это влияет на конечный результат и может его как улучшить, так и ухудшить.
    - Галочка **"Добавить рамку"** рисует прямоугольник сверхтонким чёрным абрисом вокруг каждого объекта с учётом отступа.

4.  После нажатия кнопки "OK" начнётся процесс компоновки. Поиск решения может занять длительное время, но вы можете остановить поиск в любой момент, просто закрыв диалоговое окно.
5.  По завершении работы слева будут располагаться объекты, размещённые на листе, а справа - объекты, которые не удалось разместить.

![Демонстрация работы](1.gif)

## Компиляция

Для компиляции проекта из исходных кодов вам понадобится компилятор FASM. Вы можете скачать его с [официального сайта](https://flatassembler.net/download.php).

Для компиляции 64-битной версии используйте следующую команду:

```
fasm.exe x64\DirectEnpackx64.asm x64\DirectEnpack.dll
```

В результате будет создан файл `DirectEnpack.dll`, который затем нужно переименовать в `DirectEnpackx64.cpg` и скопировать в каталог `Programs64\Addons` CorelDraw.

## Известные проблемы и способы их решения

- Если после запуска диалогового окна настройки панели команд (Инструменты->Параметры->Рабочее пространство->Настройка->Панели команд) выбрать "Отмена" - иконка аддона будет изменена на иконку по-умолчанию. Лечится перезапуском CorelDraw.
- Максимальное количество потоков ограничено числом 256. Если появится необходимость увеличить это число - нужно перекомпилировать аддон, увеличив константу **MAX_THREADS**.

## Ссылки

- [A Greedy Algorithm with Forward-Looking Strategy](https://www.researchgate.net/publication/221787421_A_Greedy_Algorithm_with_Forward-Looking_Strategy) - этот алгоритм взят за основу. В моей реализации изменена оценочная функция.
- [bin-packing](https://github.com/SebastianBitsch/bin-packing) - реализация вышеуказанного алгоритма на Python.
- [FASM](https://flatassembler.net/download.php) - компилятор ассемблера для сборки аддона (собиралось в версии 1.73.31).
